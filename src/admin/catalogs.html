<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogos - Admin</title>
    <link rel="icon" type="image/png" href="../../image/favicon.png">
    <link rel="stylesheet" href="css/admin-layout.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined">
</head>

<body>
    <div class="main-content">
        <!-- CATALOGS VIEW -->
        <div id="catalogsView" class="view-section active">
            <div class="header-actions">
                <div>
                    <h1 class="page-title">Catálogos</h1>
                    <p class="page-subtitle">Gestiona tus catálogos de productos</p>
                </div>
                <div>
                    <button type="button" class="btn-primary" onclick="openCreateCatalogModal()">
                        <span class="material-icons" style="font-size: 16px;">add</span>
                        Crear Catálogo
                    </button>
                </div>
            </div>

            <div class="catalogs-grid" id="catalogsGrid">
                <!-- Catalogs will be injected here -->
            </div>
        </div>

        <!-- CATALOG DETAIL VIEW -->
        <div id="catalogDetailView" class="view-section">
            <div class="header-actions">
                <div>
                    <button class="btn-secondary" onclick="backToCatalogs()"
                        style="margin-bottom: 0.5rem; border: none; padding-left: 0; background: transparent;">
                        <span class="material-icons" style="vertical-align: middle; font-size: 18px;">arrow_back</span>
                        Volver a Catálogos
                    </button>
                    <h1 class="page-title" id="catalogDetailTitle">Detalle del Catálogo</h1>
                    <p class="page-subtitle">Gestiona los productos de este catálogo específico</p>
                </div>
                <div>
                    <button class="btn-primary" onclick="openAddToCatalogModal()">
                        <span class="material-icons" style="font-size: 16px;">add</span>
                        Agregar Productos
                    </button>
                    <button class="btn-secondary" onclick="exportCatalog(currentCatalogId)" style="margin-left: 8px;">
                        <span class="material-icons" style="font-size: 16px;">download</span>
                    </button>
                    <button class="btn-secondary" onclick="importCatalog(currentCatalogId)" style="margin-left: 8px;">
                        <span class="material-icons" style="font-size: 16px;">upload</span>
                    </button>
                </div>
            </div>

            <div class="admin-filters">
                <input type="text" class="search-admin" placeholder="Buscar en este catálogo..."
                    id="catalogDetailSearch" onkeyup="filterCatalogDetailTable()">
            </div>

            <div class="products-table-container">
                <table id="catalogDetailTable" style="font-size: 0.9rem;">
                    <thead>
                        <tr>
                            <th width="80">IMG</th>
                            <th>NOMBRE</th>
                            <th width="150">SKU</th>
                            <th width="120">PRECIO (BS)</th>
                            <th width="100">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="catalogDetailTableBody">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
                <div id="catalogDetailEmpty" style="padding: 2rem; text-align: center; color: #999; display: none;">
                    No hay productos en este catálogo.
                </div>
            </div>
        </div>
    </div>

    <!-- CREATE CATALOG MODAL -->
    <div id="createCatalogModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Crear Catálogo</h2>
                <button class="close-modal" onclick="closeCreateCatalogModal()">&times;</button>
            </div>

            <form id="createCatalogForm">
                <div class="modal-body grid-2-equal">
                    <!-- Left Column: Catalog Metadata -->
                    <div>
                        <div class="form-group catalog-meta-field">
                            <label class="form-label">Nombre del Catálogo *</label>
                            <input type="text" id="catalogName" class="form-input" placeholder="Ej: Smartphones 2024"
                                required>
                        </div>

                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                            <div class="form-group catalog-meta-field">
                                <label class="form-label">Título del Banner (Opcional)</label>
                                <input type="text" class="form-input" id="catalogCustomTitle"
                                    placeholder="Ej: Catálogo Samsung 2026">
                            </div>
                            <div class="form-group catalog-meta-field">
                                <label class="form-label">Color Título</label>
                                <select id="catalogTitleColor" class="form-input">
                                    <option value="black">Negro</option>
                                    <option value="white">Blanco</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group catalog-meta-field">
                            <label class="form-label">Imagen del Banner (Opcional)</label>
                            <input type="file" id="catalogBannerImage" class="form-input" accept="image/*">
                            <p class="form-hint-sm">Se recomienda 1920x300px.</p>
                        </div>
                        <div class="form-group catalog-meta-field">
                            <label class="form-label">Texto de Fondo (Opcional)</label>
                            <input type="text" class="form-input" id="catalogCustomText" value="2026"
                                placeholder="Ej: 2026 o Navidad">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group catalog-meta-field">
                                <label class="form-label">Color Texto Fondo</label>
                                <select id="catalogTextColor" class="form-input">
                                    <option value="black">Negro</option>
                                    <option value="white">Blanco</option>
                                </select>
                            </div>
                            <div class="form-group catalog-meta-field">
                                <label class="form-label">Opacidad Fondo (%)</label>
                                <input type="number" id="catalogTextOpacity" class="form-input" value="50" min="0"
                                    max="100">
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Products Selection -->
                    <div class="flex-col-scroll">
                        <div class="form-group flex-col-scroll" style="margin-bottom: 0;">
                            <label class="form-label">Productos *</label>
                            <p style="font-size: 0.8125rem; color: var(--text-muted); margin-bottom: 0.75rem;">
                                Selecciona los productos para incluir en el catálogo
                            </p>

                            <!-- Search -->
                            <input type="text" id="catalogProductSearch" class="form-input"
                                placeholder="Buscar productos..." onkeyup="filterCatalogProducts()"
                                style="margin-bottom: 0.75rem;">

                            <!-- Select All -->
                            <div
                                style="background: #fafafa; padding: 0.75rem; border-radius: var(--radius-sm); margin-bottom: 0.75rem;">
                                <label
                                    style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin: 0;">
                                    <input type="checkbox" id="selectAllCatalogProducts"
                                        onchange="toggleAllCatalogProducts()">
                                    <span style="font-weight: 500; font-size: 0.875rem;">Seleccionar Todos</span>
                                    <span id="selectedProductsCount"
                                        style="color: var(--text-muted); margin-left: auto; font-size: 0.8125rem;">
                                        0 seleccionados
                                    </span>
                                </label>
                            </div>

                            <!-- Products List -->
                            <div id="catalogProductsList" class="products-list products-list-scroll">
                                <!-- Products will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeCreateCatalogModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-primary">
                        <span class="material-icons" style="font-size: 16px;">add</span>
                        Crear Catálogo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Needed for product editing via window.editProduct -->
    <div id="productModal" class="modal">
        <!-- Simplified mock modal just to prevent errors if invoked, or we need the full one?
              We used window.editProduct which assumes productModal exists and uses admin.js logic.
              Ideally, clicking edit in catalogs should just redirect to products.html?id=...
              But for now, I'll include the productModal structure hidden or duplicated.
              Actually, catalog-system.js lines 438 checks for openProductModal function.
         -->
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/layout.js"></script>
    <script src="../data/products.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- We need admin.js for loadProductsIntoModal validation/logic if it uses global functions? 
         catalog-system.js uses window.products.
    -->
    <script src="js/admin.js"></script>
    <script src="js/catalog-system.js"></script>

    <script>
        // Override backToCatalogs to work with this structure if needed (it already toggles display)
    </script>
</body>

</html>